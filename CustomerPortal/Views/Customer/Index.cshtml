
@model CustomerPortal.ViewModel.CustomerViewModel

@{
   ViewData["Title"] = "My Profile";
}

@section Scripts {
    <script>
        // edit button actions on click 
        document.getElementById("editBtn").addEventListener("click",  () => {
            // Make fields editable and keep customerId readonly
            document.querySelectorAll("input").forEach(input => {
                if (input.id !== "CustomerID" && input.id !== "currentPassword" 
                    && input.id !== "newPassword" && input.id !== "confirmPassword") {
                    input.disabled = false;
                }
            });

            // Handle buttons
            document.getElementById("editBtn").disabled = true;
            document.getElementById("cancelBtn").removeAttribute("disabled");
            document.getElementById("saveBtn").removeAttribute("disabled");
        });

        // cancel button actions on click 
        document.getElementById("cancelBtn").addEventListener("click",  () => {
            // Make editable fields back to readOnly 
            document.querySelectorAll("input").forEach(input => {
                if (input.id !== "currentPassword"
                    && input.id !== "newPassword" && input.id !== "confirmPassword") {
                    input.disabled = true;
                }
                
            });

            // Handle buttons
            document.getElementById("editBtn").removeAttribute("disabled");
            document.getElementById("cancelBtn").disabled = true;
            document.getElementById("saveBtn").disabled = true;
        });
        
        //Handle password change modal visibility
        document.addEventListener("DOMContentLoaded", function () {
            var message = '@Model.PasswordChangeMessage';
            var isSuccess = '@Model.IsPasswordChangeSuccess';

            if (message && message.length > 0) {
                var modalEl = document.getElementById("changePasswordModal");
                var modal = new bootstrap.Modal(modalEl);
                modal.show();

                // Close automatically only if success
                if (isSuccess === 'True') {
                    setTimeout(() => modal.hide(), 1500);
                }
            }
        });

        // handle password change confirmation msg
        document.addEventListener("DOMContentLoaded", function () {
            const form = document.getElementById("changePasswordForm");
            form.addEventListener("submit", function(e) {
                if (!confirm("Are you sure you want to update the password?")) {
                    e.preventDefault();
                }
            });
        });
    </script>
}

<div class="text-center justify-content-center align-items-center d-flex flex-column">
   <h3 class="mb-3 text-center">My Profile</h3>
   <h6 class="text-center text-muted mb-2">Edit and update profile details using the "edit" and "save" buttons below. 
       You can also update the current password using the "Change Password" button</h6>
   
   <div class="justify-content-center mb-5">
       <div class="p-4 justify-content-center" style="width: 500px;">
         
           @if (!string.IsNullOrEmpty(Model.Message))
           {
               <div class="alert @(Model.IsSuccess ? "alert-success" : "alert-danger") text-center">
                   @Model.Message
               </div>
           }
           
           <form asp-controller="Customer" asp-action="UpdateCustomer" method="post" id="profileForm" onsubmit="return confirm('Are you sure you want to update details?');">   
               <div class="row">
                   <div class="col-md-6 mb-3">
                       <label asp-for="CustomerID" class="form-label"></label>
                       <input asp-for="CustomerID" class="form-control" disabled="disabled" />
                   </div>

                   <div class="col-md-6 mb-3">
                       <label asp-for="Name" class="form-label"></label>
                       <input asp-for="Name" class="form-control editable" disabled="disabled" />
                   </div>
               </div>

               <div class="row">
                   <div class="col-md-6 mb-3">
                       <label asp-for="TFN" class="form-label"></label>
                       <input asp-for="TFN" class="form-control editable" disabled="disabled" />
                   </div>

                   <div class="col-md-6 mb-3">
                       <label asp-for="Mobile" class="form-label"></label>
                       <input asp-for="Mobile" class="form-control editable" disabled="disabled" />
                   </div>
               </div>

               <div class="row">
                   <div class="col-md-12 mb-3">
                       <label asp-for="Address" class="form-label"></label>
                       <input asp-for="Address" class="form-control editable" disabled="disabled" />
                   </div>
               </div>
             
               <div class="row">
                   <div class="col-md-12 mb-3">
                       <label asp-for="City" class="form-label"></label>
                       <input asp-for="City" class="form-control editable" disabled="disabled" />
                   </div>
               </div>

               <div class="row">
                 
                   <div class="col-md-6 mb-3">
                       <label asp-for="State" class="form-label"></label>
                       <input asp-for="State" class="form-control editable" maxlength="3" disabled="disabled" />
                   </div>

                   <div class="col-md-6 mb-3">
                       <label asp-for="PostCode" class="form-label"></label>
                       <input asp-for="PostCode" class="form-control editable" disabled="disabled" />
                   </div>
               </div>

               <div class="d-flex gap-4 mt-3 justify-content-center align-items-center">
                   <button type="button" class="btn btn-outline-secondary" id="editBtn">Edit</button>
                   <button type="submit" class="btn btn-primary" id="saveBtn" disabled="disabled">Save</button>
                   <button type="button" class="btn btn-outline-secondary" id="cancelBtn" disabled="disabled">Cancel</button>
                   <button type="button" class="btn btn-secondary" id="changePassword" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Change Password</button>
               </div>
           </form>
         
       </div>
       
       @* Modal for change password of the customer *@
       <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordLabel" aria-hidden="true">
           <div class="modal-dialog modal-dialog-centered">
               <div class="modal-content">
                   <div class="modal-header">
                       <h5 class="modal-title" id="changePasswordLabel">Change Password</h5>
                       <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                   </div>
                   @if (!string.IsNullOrEmpty(Model.PasswordChangeMessage))
                   {
                       <div class="alert @(Model.IsPasswordChangeSuccess ? "alert-success" : "alert-danger") text-center">
                           @Model.PasswordChangeMessage
                       </div>
                   }
                   <div class="modal-body">
                       <form id="changePasswordForm" asp-controller="Customer" asp-action="ChangePassword" method="post">
                           <div class="mb-3">
                               <label for="currentPassword" class="form-label">Current Password</label>
                               <input type="password" name="CurrentPassword" id="currentPassword" class="form-control" required />
                           </div>
                           <div class="mb-3">
                               <label for="newPassword" class="form-label">New Password</label>
                               <input type="password" name="NewPassword" id="newPassword" class="form-control" required />
                           </div>
                           <div class="mb-3">
                               <label for="confirmPassword" class="form-label">Confirm Password</label>
                               <input type="password" name="ConfirmPassword" id="confirmPassword" class="form-control" required />
                           </div>
                           <div class="d-flex justify-content-end">
                               <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                               <button type="submit" class="btn btn-primary">Update Password</button>
                           </div>
                       </form>
                   </div>
               </div>
           </div>
       </div>
       
   </div>
</div>
    

    

    