
@using CustomerPortal.Utility
@model CustomerPortal.ViewModel.BillPay.BillPayListViewModel
@{
   ViewData["Title"] = "Bill Pay";
}

<div class="text-center justify-content-center align-items-center d-flex flex-column">
   <h3 class="mb-3 text-center">Bill Payments</h3>
   <h6 class="text-center text-muted mb-2">Schedules bill payments with their statuses. Click the "Create" button to add a new bill schedule.</h6>
   
   <div class="justify-content-center mb-5">
      <div class="p-4 justify-content-center" style="width: 100%;">
         <div asp-validation-summary="All" class="text-danger"></div>

         @if (!string.IsNullOrEmpty(Model.Message))
         {
            <div class="alert @(Model.IsSuccess ? "alert-success" : "alert-danger") text-center">
               @Model.Message
            </div>
         }
        
         <table class="table table-bordered table-striped shadow-sm">
                <thead class="table-primary">
                    <tr>
                        <th>BillPay ID</th>
                        <th>Account</th>
                        <th>Payee</th>
                        <th>Amount</th>
                        <th>Period</th>
                        <th>Scheduled Time</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                @if (Model.Bills.Any())
                {
                    foreach (var bill in Model.Bills)
                    {
                        <tr>
                            <td>@bill.BillPayID</td>
                            <td>@bill.AccountNumber</td>
                            <td>@bill.PayeeID</td>
                            <td>@bill.Amount.ToString("C")</td>
                            <td>@bill.BillPeriod</td>
                            <td>@bill.LocalScheduleTime</td>
                            <td>
                                <span class="badge bg-@(bill.Status == BillStatus.Pending ? "warning" : bill.Status == BillStatus.Success ? "success" : "danger")">
                                    @bill.Status
                                </span>
                            </td>
                            <td>
                                @if (bill.Status == BillStatus.Pending)
                                {
                                    <a asp-action="Remove" asp-route-id="@bill.BillPayID"
                                       class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to cancel this bill payment schedule?');">Cancel</a>
                                }
                                else if (bill.Status == BillStatus.Failed)
                                {
                                    <a asp-action="Retry" asp-route-id="@bill.BillPayID"
                                       class="btn btn-sm btn-outline-success" onclick="return confirm('Are you sure you want to restart bill schedule?');">Retry</a>
                                }
                                else
                                {
                                    <span>N/A</span>
                                }
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="8" class="text-center text-muted">No bill payments found.</td>
                    </tr>
                }
                </tbody>
            </table>

            <div class="text-center mt-4">
                <a asp-controller="BillPay" asp-action="CreateView" class="btn btn-success">Create New Bill</a>
            </div>
         
      </div>
   </div>
</div>